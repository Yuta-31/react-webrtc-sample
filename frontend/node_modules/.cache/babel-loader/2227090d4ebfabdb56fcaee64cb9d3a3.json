{"ast":null,"code":"var _jsxFileName = \"/Users/yuta/Documents/work/web-rtc/frontend/src/VideoConnect2.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport './Video.css';\nimport socketClient from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SERVER = \"http://localhost:3001\";\nconst socket = socketClient(SERVER);\nvar isHost = false;\nvar room = 'hoge';\nconst constraints = {\n  video: true,\n  audio: false\n};\nconst offerOptions = {\n  offerToReceiveVideo: 1\n};\nvar localStream = null;\nvar remoteStream = null;\nvar peerConnection = null;\nvar isStarted = false;\nlet config = {\n  \"iceServers\": [{\n    \"urls\": \"stun:stun.l.google.com:19302\"\n  }, {\n    \"urls\": \"stun:stun1.l.google.com:19302\"\n  }, {\n    \"urls\": \"stun:stun2.l.google.com:19302\"\n  }]\n};\nexport default function VideoConnect2() {\n  _s();\n\n  const localVideoRef = React.useRef(null);\n  const remoteVideoRef = React.useRef(null);\n  const [isKnocking, setIsKnocking] = React.useState(false);\n  const [canCalling, setCanCalling] = React.useState(false);\n  const [isAllowed, setIsAllowed] = React.useState(false);\n  socket.on('knocked response', (numClients, room) => {\n    if (numClients === 0) {\n      socket.emit('create', room);\n    } else if (numClients === 1) {\n      socket.emit('join', room);\n    } else {\n      console.log(\"room [\" + room + \"] is full.\");\n    }\n  });\n  socket.on('created', room => {\n    console.log('[Server said] you created room [' + room + ']');\n    isHost = true;\n\n    if (!isStarted) {\n      startConnect();\n    }\n  });\n  socket.on('joined', (room, id) => {\n    console.log('[Server said] ' + id + ' joined room [' + room + ']');\n\n    if (isHost) {\n      setIsKnocking(true);\n    } else {\n      if (!isStarted) {\n        startConnect();\n      }\n    }\n  });\n  socket.on('allowed', () => {\n    console.log('allowed!');\n    setRemoteStream(remoteStream);\n  });\n  socket.on('offer', description => {\n    console.log('Offer received');\n\n    if (!isHost && !isStarted) {\n      startConnect();\n    }\n\n    peerConnection.setRemoteDescription(description);\n    peerConnection.createAnswer().then(setLocalAndSendMessage).catch(handleAnswerError);\n  });\n  socket.on('answer', description => {\n    console.log('Answer received');\n\n    if (isStarted) {\n      peerConnection.setRemoteDescription(description);\n    }\n  });\n  socket.on('candidate', description => {\n    console.log('candidate Recieved');\n\n    if (isStarted) {\n      peerConnection.addIceCandidate(new RTCIceCandidate({\n        sdpMLineIndex: description.label,\n        candidate: description.candidate\n      }));\n    }\n  });\n\n  function createPeerConnection() {\n    try {\n      peerConnection = new RTCPeerConnection(config);\n      peerConnection.onicecandidate = handleConnection;\n      peerConnection.onaddstream = handleAddStream;\n      peerConnection.onremovestream = handleRemoveStream;\n      console.log('PeerConnection is created');\n    } catch (error) {\n      console.log('[ERROR]', error);\n      return;\n    }\n  }\n\n  function handleConnection(event) {\n    if (event.candidate && peerConnection.signalingState !== 'stable') {\n      console.log(peerConnection.signalingState);\n      socket.emit('message', {\n        type: 'candidate',\n        label: event.candidate.sdpMLineIndex,\n        id: event.candidate.sdpMid,\n        candidate: event.candidate.candidate\n      });\n    } else {\n      console.log(remoteVideoRef);\n      console.log('End of candidates');\n    }\n  }\n\n  function handleAddStream(event) {\n    console.log('add stream');\n    remoteStream = event.stream;\n  }\n\n  function handleRemoveStream(event) {\n    console.log(event);\n  }\n\n  function startConnect() {\n    createPeerConnection();\n    peerConnection.addStream(localStream);\n    isStarted = true;\n\n    if (!isHost) {\n      peerConnection.createOffer(offerOptions).then(setLocalAndSendMessage).catch(handleOfferError);\n    }\n  }\n\n  function setLocalAndSendMessage(description) {\n    peerConnection.setLocalDescription(description);\n    socket.emit('message', description);\n  }\n\n  function handleOfferError(error) {\n    console.log(\"[ERROR]\", error);\n  }\n\n  function handleAnswerError(error) {\n    console.log(\"[ERROR]\" + error.toString());\n  }\n\n  function allowJoin() {\n    console.log(remoteVideoRef);\n    remoteVideoRef.current.srcObject = remoteStream;\n    console.log('allow');\n    socket.emit('allow');\n  }\n\n  function calling() {\n    socket.emit('knock', room);\n  }\n\n  React.useEffect(() => {\n    navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n      localStream = stream;\n      console.log(localStream);\n      localVideoRef.current.srcObject = stream;\n      setCanCalling(true);\n    }).catch(error => {\n      console.log(\"ERROR\", error);\n    });\n  }, []);\n  React.useEffect(() => {\n    remoteVideoRef.current.srcObject = remoteStreams;\n  }, [remoteStreams]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"VideoView\",\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      playsInline: true,\n      autoPlay: true,\n      ref: localVideoRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      playsInline: true,\n      autoPlay: true,\n      ref: remoteVideoRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: allowJoin,\n      disabled: !isKnocking,\n      children: \"ALLOW\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: calling,\n      disabled: !canCalling,\n      children: \"CALL\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 180,\n    columnNumber: 5\n  }, this);\n}\n\n_s(VideoConnect2, \"OoemeHqe+FXX1mIaKeC1+mwwReg=\");\n\n_c = VideoConnect2;\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoConnect2\");","map":{"version":3,"sources":["/Users/yuta/Documents/work/web-rtc/frontend/src/VideoConnect2.js"],"names":["React","socketClient","SERVER","socket","isHost","room","constraints","video","audio","offerOptions","offerToReceiveVideo","localStream","remoteStream","peerConnection","isStarted","config","VideoConnect2","localVideoRef","useRef","remoteVideoRef","isKnocking","setIsKnocking","useState","canCalling","setCanCalling","isAllowed","setIsAllowed","on","numClients","emit","console","log","startConnect","id","setRemoteStream","description","setRemoteDescription","createAnswer","then","setLocalAndSendMessage","catch","handleAnswerError","addIceCandidate","RTCIceCandidate","sdpMLineIndex","label","candidate","createPeerConnection","RTCPeerConnection","onicecandidate","handleConnection","onaddstream","handleAddStream","onremovestream","handleRemoveStream","error","event","signalingState","type","sdpMid","stream","addStream","createOffer","handleOfferError","setLocalDescription","toString","allowJoin","current","srcObject","calling","useEffect","navigator","mediaDevices","getUserMedia","remoteStreams"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './Video.css';\nimport socketClient from 'socket.io-client';\n\nconst SERVER = \"http://localhost:3001\";\n\nconst socket = socketClient(SERVER);\n\nvar isHost = false;\nvar room = 'hoge';\n\nconst constraints = {\n  video: true,\n  audio: false,\n}\nconst offerOptions = {\n  offerToReceiveVideo: 1,\n}\n\nvar localStream = null;\nvar remoteStream = null;\nvar peerConnection = null;\nvar isStarted = false;\n\nlet config = {\n  \"iceServers\": [\n    { \"urls\": \"stun:stun.l.google.com:19302\" },\n    { \"urls\": \"stun:stun1.l.google.com:19302\" },\n    { \"urls\": \"stun:stun2.l.google.com:19302\" },\n  ]\n};\n\n\nexport default function VideoConnect2() {\n  const localVideoRef = React.useRef(null);\n  const remoteVideoRef = React.useRef(null);\n  const [isKnocking, setIsKnocking] = React.useState(false);\n  const [canCalling, setCanCalling] = React.useState(false);\n  const [isAllowed, setIsAllowed] = React.useState(false);\n\n  socket.on('knocked response', (numClients, room) => {\n    if (numClients === 0) {\n      socket.emit('create', room);\n    } else if (numClients === 1) {\n      socket.emit('join', room);\n    } else {\n      console.log(\"room [\" + room + \"] is full.\");\n    }\n  });\n  socket.on('created', (room) => {\n    console.log('[Server said] you created room [' + room + ']');\n    isHost = true;\n    if (!isStarted) {\n      startConnect();\n    }\n  });\n  socket.on('joined', (room, id) => {\n    console.log('[Server said] ' + id + ' joined room [' + room + ']');\n    if (isHost) {\n      setIsKnocking(true);\n    } else {\n      if (!isStarted) {\n        startConnect();\n      }\n    }\n  });\n  socket.on('allowed', () => {\n    console.log('allowed!');\n    setRemoteStream(remoteStream);\n  });\n  socket.on('offer', (description) => {\n    console.log('Offer received');\n    if (!isHost && !isStarted) {\n      startConnect();\n    }\n    peerConnection.setRemoteDescription(description);\n    peerConnection.createAnswer()\n      .then(setLocalAndSendMessage)\n      .catch(handleAnswerError);\n  });\n  socket.on('answer', (description) => {\n    console.log('Answer received');\n    if (isStarted) {\n      peerConnection.setRemoteDescription(description);\n    }\n  });\n  socket.on('candidate', (description) => {\n    console.log('candidate Recieved');\n    if (isStarted) {\n      peerConnection.addIceCandidate(\n        new RTCIceCandidate({\n          sdpMLineIndex: description.label,\n          candidate: description.candidate,\n        })\n      );\n    }\n  });\n\n  function createPeerConnection() {\n    try {\n      peerConnection = new RTCPeerConnection( config );\n      peerConnection.onicecandidate = handleConnection;\n      peerConnection.onaddstream = handleAddStream;\n      peerConnection.onremovestream = handleRemoveStream;\n      console.log('PeerConnection is created');\n    } catch (error) {\n      console.log('[ERROR]', error);\n      return;\n    }\n  }\n  function handleConnection(event) {\n    if (event.candidate && peerConnection.signalingState !== 'stable') {\n      console.log(peerConnection.signalingState);\n      socket.emit('message', {\n        type: 'candidate',\n        label: event.candidate.sdpMLineIndex,\n        id: event.candidate.sdpMid,\n        candidate: event.candidate.candidate\n      });\n    } else {\n      console.log(remoteVideoRef);\n      console.log('End of candidates');\n    }\n  }\n  function handleAddStream(event) {\n    console.log('add stream');\n    remoteStream = event.stream;\n  }\n  function handleRemoveStream(event) {\n    console.log(event);\n  }\n  function startConnect() {\n    createPeerConnection();\n    peerConnection.addStream(localStream);\n    isStarted = true;\n    if (!isHost) {\n      peerConnection.createOffer(offerOptions)\n        .then(setLocalAndSendMessage)\n        .catch(handleOfferError);\n    }\n  }\n  function setLocalAndSendMessage(description) {\n    peerConnection.setLocalDescription(description);\n    socket.emit('message', description);\n  }\n  function handleOfferError(error) {\n    console.log(\"[ERROR]\", error);\n  }\n  function handleAnswerError(error) {\n    console.log(\"[ERROR]\" + error.toString());\n  }\n  function allowJoin() {\n    console.log(remoteVideoRef);\n    remoteVideoRef.current.srcObject = remoteStream;\n    console.log('allow');\n    socket.emit('allow');\n  }\n  function calling() {\n    socket.emit('knock', room);\n  }\n\n  React.useEffect(() => {\n    navigator.mediaDevices.getUserMedia(constraints)\n      .then((stream) => {\n        localStream = stream;\n        console.log(localStream);\n        localVideoRef.current.srcObject = stream;\n        setCanCalling(true);\n      })\n      .catch((error) => {\n        console.log(\"ERROR\", error);\n      });\n  }, []);\n\n  React.useEffect(() => {\n    remoteVideoRef.current.srcObject = remoteStreams;\n  },[remoteStreams]);\n\n  return (\n    <div className=\"VideoView\">\n      <video playsInline autoPlay ref={localVideoRef} />\n      <video playsInline autoPlay ref={remoteVideoRef} />\n      <br />\n      <button onClick={allowJoin} disabled={!isKnocking}>ALLOW</button>\n      <button onClick={calling} disabled={!canCalling}>CALL</button>\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}